# âœ” Usage Examples

**NexPloit CLI** includes many features in addition to scan control over our API, here are some examples of various use cases:

### ðŸŒŽ Section Map <!-- {docsify-ignore} -->

- [npm](#npm)
  - [New Scan From a Swagger Schema](#new-scan-from-a-swagger-schema)
  - [Re-Run a Previous Scan](#re-run-a-previous-scan)
  - [New Scan With a Repeater](#new-scan-with-a-repeater)
- [Docker (Repeater Mode)](#docker)
  - [Set Up](#set-up)
  - [Run a New Scan With Docker Startup](#run-a-new-scan-with-docker-startup)
  - [Adding Extra Headers Locally](#adding-extra-headers-locally)

<hr style="height:2px;background-color:#d1d3d4">

## npm

### New Scan From a Swagger Schema

An example of how to scan an API endpoint directly.
The scope of the scan, all the possible interactions and parameters are defined in an OpenAPI schema which is uploaded prior to starting the scan.
> [!NOTE|label:Prerequisites]
> - An active user on www.nexploit.app
> - A Swagger/OpenAPI schema `FILE_PATH`
> - A valid `AUTH_TOKEN` with the scopes: `files:read`, `files:write`, `scans:run`, `scans:read`
>   - You can set up an [Organization level Authentication Token](user-guide/organization-administration/details-and-policies.md#managing-organization-api-keys)
>   - Or, a [User level Authentication Token](user-guide/personal-account-administration/details-and-settings.md#managing-your-api-keys)

#### Step-by-step Guide

<!-- tabs:start -->

##### **STEP 1 - Upload a schema**

```bash
FILE_ID=$(nexploit-cli archive:upload \
  --token $AUTH_TOKEN \
  --type openapi \
  --discard true \
  $FILE_PATH)
```

##### **STEP 2 - Create a new scan**

```bash
SCAN_ID=$(nexploit-cli scan:run \
  --token $AUTH_TOKEN \
  --name "My First Scan" \
  --archive $FILE_ID \
  --smart)
```

##### **STEP 3 - Poll scan status**

```bash
nexploit-cli scan:polling \
  --token $AUTH_TOKEN \
  --breakpoint high_issue \
  --interval 3000 \
  --timeout 1h \
  $SCAN_ID
```

<!-- tabs:end -->

<hr style="height:2px;background-color:#d1d3d4">

### Re-Run a Previous Scan

An example of how to re-run a previous scan, using all the same scan settings and parameters.

> [!NOTE|label:Prerequisites]
> - An active user on www.nexploit.app
> - A previous `SCAN_ID`
> - A valid `AUTH_TOKEN` with the scopes: `scans:run`, `scans:read`
>   - You can set up an [Organization level Authentication Token](user-guide/organization-administration/details-and-policies.md#managing-organization-api-keys)
>   - Or, a [User level Authentication Token](user-guide/personal-account-administration/details-and-settings.md#managing-your-api-keys)

#### Step-by-step Guide

<!-- tabs:start -->

##### **STEP 1 - Re-run a previous scan**

```bash
NEW_SCAN_ID=$(nexploit-cli scan:retest \
  --token $AUTH_TOKEN \
  $SCAN_ID)
```

##### **STEP 2 - Poll scan status**

```bash
nexploit-cli scan:polling \
  --token $AUTH_TOKEN \
  --breakpoint high_issue \
  --interval 3000 \
  --timeout 1h \
  $NEW_SCAN_ID
```

<!-- tabs:end -->

### New Scan With a Repeater

An example of how to run a scan, using the CLI's local [Repeater](/deployment/repeater.md) feature.

> [!NOTE|label:Prerequisites]
> - An active user on www.nexploit.app
> - A valid `AUTH_TOKEN` with the scopes: `repeaters:write`, `scans:run`, `scans:read`
>   - You can set up an [Organization level Authentication Token](user-guide/organization-administration/details-and-policies.md#managing-organization-api-keys)
>   - Or, a [User level Authentication Token](user-guide/personal-account-administration/details-and-settings.md#managing-your-api-keys)
> - An active `REPEATER_ID`
>   - More info about [Setting up a New Repeater](user-guide/agents/overview.md)


#### Step-by-step Guide

<!-- tabs:start -->

##### **STEP 1 - Start a Repeater**

```bash
PID_REPEATER=$(nexploit-cli repeater \
  --token=plhzeup.nexp.0lhtc7ib5pogcibaqprz6gz994sltelu 
  --id=b5b03145-1f30-4002-bab1-8f1b58df4bf9 \
  & > /dev/null \
  & echo $! )

echo "Repeater PID: $PID_REPEATER"
```

##### **STEP 2 - Run a new scan with Crawler**

```bash
SCAN_ID=$(nexploit-cli scan:run \
  --token $AUTH_TOKEN \
  --name "My First Scan" \
  --repeater $REPEATER_ID \
  --crawler www.example.com \
  --host-filter www.example.com \
  --smart \
  $SCAN_ID)
```

##### **STEP 3 - Poll scan status**

```bash
nexploit-cli scan:polling \
  --token $AUTH_TOKEN \
  --breakpoint high_issue \
  --interval 3000 \
  --timeout 1h \
  $SCAN_ID
```

<!-- tabs:end -->

## Docker (Repeater Mode)

The [Docker version of NexPloit CLI](https://hub.docker.com/r/neuralegion/repeater) comes as a pre-configured [Repeater](/deployment/repeater.md) container. As soon as the container is launched the CLI activates the [Repeater](/deployment/repeater.md) mode.

### Set Up

> [!NOTE|label:Prerequisites]
> - An active user on www.nexploit.app
> - You must have [Docker Compose](https://docs.docker.com/compose/install/) installed.
> - A valid `REPEATER-TOKEN` with the scope `repeaters:write`
>   - You can set up an [Organization level Authentication Token](user-guide/organization-administration/details-and-policies.md#managing-organization-api-keys)
>   - Or, a [User level Authentication Token](user-guide/personal-account-administration/details-and-settings.md#managing-your-api-keys)
> - An active `REPEATER-ID`
>   - More info about [Setting up a New Repeater](/user-guide/agents/overview.md)

#### Step-by-step Guide

<!-- tabs:start -->

##### **STEP 1 - Create a .yml file**

```yaml
version: '3'
services:
  target.local:
    image: path/image-name

  repeater:
    image: neuralegion/repeater:latest
    restart: always
    environment:
      REPEATER_TOKEN: REPEATER-TOKEN
      REPEATER_ID: REPEATER-ID
```

##### **STEP 2 - Run the Docker**

Run the **Repeater Docker** using the command:

```
docker-compose up
```

!> **Note**: If did not add a valid `REPEATER-TOKEN` and `REPEATER-ID` you will get the following error: `Unauthorized access. Please check your credentials.`
<!-- tabs:end -->


Now, when [Starting a New Scan](user-guide/scans/new-scan), you can connect the Repeater under [Addition Settings](user-guide/scans/new-scan#additional-settings) in the UI or use the CLI to start a scan.

<hr style="height:2px;background-color:#d1d3d4">


### Run a New Scan With Docker Startup

The Docker version of the Repeater comes with a built-in [NexPloit-CLI](nexploit-cli/overview.md), so it is possible to add more functions to the docker contaner to execute after the Repeater mode is launched.

Here is an example of a `.yaml` configuration that will launch a new scan as soon as the Docker is running:

> [!NOTE|label:Prerequisites]
> - An active user on www.nexploit.app
> - You must have [Docker Compose](https://docs.docker.com/compose/install/) installed.
> - A valid `REPEATER-TOKEN` with the scope `repeaters:write`, `files:write`, `scans:run`, `scans:read`
>   - You can set up an [Organization level Authentication Token](user-guide/organization-administration/details-and-policies.md#managing-organization-api-keys)
>   - Or, a [User level Authentication Token](user-guide/personal-account-administration/details-and-settings.md#managing-your-api-keys)
> - An active `REPEATER-ID`
>   - More info about [Setting up a New Repeater](/user-guide/agents/overview.md)


```yaml
version: '3'
services:
  target.local:
    image: path/image-name
    ports:
      - '3000:3000'

  repeater:
    image: neuralegion/repeater:latest
    restart: always
    environment:
      REPEATER_TOKEN: REPEATER-TOKEN
      REPEATER_ID: REPEATER-ID

  nexploit:
    depends_on:
      - repeater
      - target.local
    image: neuralegion/repeater:nexploit-cli
    environment:
      REPEATER_TOKEN: REPEATER-TOKEN
      REPEATER_ID: REPEATER-ID
    entrypoint:
      - bash
      - -c
      - >
        sleep 10;
        HARID=$$(nexploit-cli archive:upload --type openapi --token=$$REPEATER_TOKEN /opt/repeater/swagger.yaml);
        echo Your HAR ID is $$HARID;
        SCANID=$$(nexploit-cli scan:run --name='My Scan' --repeater=$$REPEATER_ID --archive $$HARID --tests header_security --token $$REPEATER_TOKEN);
        echo Scan started $$SCAN_ID;
        echo Poll for scan results;
        RESULT=$$(nexploit-cli scan:polling --token $$REPEATER_TOKEN --breakpoint=high_issue \
          --interval=10000 --timeout=5min $$SCAN_ID);
        nexploit-cli scan:stop --token=$$REPEATER_TOKEN $$SCAN_ID;
        exit $$RESULT;
```

<hr style="height:2px;background-color:#d1d3d4">

### Adding Extra Headers Locally

The Repeater allows a user to overload extra headers onto the Repeater's requests **LOCALLY**, without the need to set them up in NexPloit's cloud engine. This is done by setting the `REPEATER_HEADERS` environment variable.

For example:

```yaml
version: '3'
services:
  repeater:
    image: neuralegion/repeater:latest
    restart: always
    environment:
      REPEATER_TOKEN: REPEATER-TOKEN
      REPEATER_ID: cdf07782-bc6c-486a-b459-e182808faa33
      REPEATER_HEADERS: '{ "my_header": "special token" }'
```

Or as a command line configuration:

```
docker run neuralegion/repeater -e 'REPEATER_HEADERS={"my_header": "special token"}'
```
